# 聚类简介

聚类就是分类

对象之间的距离是聚类的度量衡：类内距离最小化，类间距离最大化。

一般是欧氏距离（直线距离），也可以是曼哈顿距离、切比雪夫距离等

如下图：

![](https://github.com/user-wbgithub/R/blob/master/images/2020-02-07_145539.jpg)

#### R中计算距离的方法

欧氏距离dist(数据矩阵)

曼哈顿距离dist(数据矩阵，method="manhattan")

切比雪夫距离dist(数据矩阵，method="maximum")

```R
> x1<-c(1,2)
> x2<-c(3,4)
> rbind(x1,x2)
   [,1] [,2]
x1    1    2
x2    3    4
> dist(rbind(x1,x2))
         x1
x2 2.828427
> x3<-c(5,6)
> x4<-c(7,8)
> dist(rbind(x1,x2,x3,x4))
         x1       x2       x3
x2 2.828427                  
x3 5.656854 2.828427         
x4 8.485281 5.656854 2.828427
> dist(rbind(x1,x2,x3,x4),method="manhattan")
   x1 x2 x3
x2  4      
x3  8  4   
x4 12  8  4
> dist(rbind(x1,x2,x3,x4),method="maximum")
   x1 x2 x3
x2  2      
x3  4  2   
x4 
```

## 聚类入门--系统聚类法（层次聚类）

系统聚类法：层数越往上，类别越少。

这种算法只适合于数据量较少的情况使用，因为样本越多，计算代价越大。

大概如下图：

![](https://github.com/user-wbgithub/R/blob/master/images/2020-02-07_164554.jpg)

#### R中使用系统聚类法建模

准备数据框数据集-->更改行号(rownames)-->计算每个点之间的距离-->建立系统聚类模型(hclust)-->画出模型图(plot)-->具体聚类函数(rect.hclust(model,具体几类))

```R
> city<-read.table("city.txt",header=T)
> city
        x1     x2     x3     x4     x5      x6      x7     x8
1  2959.19 730.79 749.41 513.34 467.87 1141.82  478.42 457.64
2  2459.77 495.47 697.33 302.87 284.19  735.97  570.84 305.08
3  1495.63 515.90 362.37 285.32 272.95  540.58  364.91 188.63
4  1046.33 477.77 290.15 208.57 201.50  414.72  281.84 212.10
5  1303.97 524.29 254.83 192.17 249.81  463.09  287.87 192.96
6  1730.84 553.90 246.91 279.81 239.18  445.20  330.24 163.86
7  1561.86 492.42 200.49 218.36 220.69  459.62  360.48 147.76
8  1410.11 510.71 211.88 277.11 224.65  376.82  317.61 152.85
9  3712.31 550.74 893.37 346.93 527.00 1034.98  720.33 462.03
10 2629.16 557.32 689.73 435.69 514.66  795.87  575.76 323.36
11 1844.78 430.29 271.28 126.33 250.56  513.18  314.00 151.39
12 2709.46 428.11 334.12 160.77 405.14  461.67  535.13 232.29
13 1563.78 303.65 233.81 107.90 209.70  393.99  509.39 160.12
14 1675.75 613.32 550.71 219.79 272.59  599.43  371.62 211.84
15 1427.65 431.79 288.55 208.14 217.00  337.76  421.31 165.32
16 1783.43 511.88 282.84 201.01 237.60  617.74  523.52 182.52
17 1942.23 512.27 401.39 206.06 321.29  697.22  492.60 226.45
18 3055.17 353.23 564.56 356.27 811.88  873.06 1082.82 420.81
19 2033.87 300.82 338.65 157.78 329.06  621.74  587.02 218.27
20 2057.86 186.44 202.72 171.79 329.65  477.17  312.93 279.19
21 2303.29 589.99 516.21 236.55 403.92  730.05  438.41 225.80
22 1974.28 507.76 344.79 203.21 240.24  575.10  430.36 223.46
23 1673.82 437.75 461.61 153.32 254.66  445.59  346.11 191.48
24 2194.25 537.01 369.07 249.54 290.84  561.91  407.70 330.95
25 2646.61 839.70 204.44 209.11 379.30  371.04  269.59 389.33
26 1472.95 390.89 447.95 259.51 230.61  490.90  469.10 191.34
27 1525.57 472.98 328.90 219.86 206.65  449.69  249.66 228.19
28 1654.69 437.77 258.78 303.00 244.93  479.53  288.56 236.51
29 1375.46 480.99 273.84 317.32 251.08  424.75  228.73 195.93
30 1608.82 536.05 432.46 235.82 250.28  541.30  344.85 214.40
> rownames(city)<-c("北京","天津","河北","山西","内蒙古","辽宁","吉林","黑龙江","上海","浙江","安徽","福建","江西","山东","河南","湖北","湖南","广东","广西","海南","重庆","四川","贵州","云南","西藏","陕西","甘肃","青海","宁夏","新疆")
> city
            x1     x2     x3     x4     x5      x6      x7     x8
北京   2959.19 730.79 749.41 513.34 467.87 1141.82  478.42 457.64
天津   2459.77 495.47 697.33 302.87 284.19  735.97  570.84 305.08
河北   1495.63 515.90 362.37 285.32 272.95  540.58  364.91 188.63
山西   1046.33 477.77 290.15 208.57 201.50  414.72  281.84 212.10
内蒙古 1303.97 524.29 254.83 192.17 249.81  463.09  287.87 192.96
辽宁   1730.84 553.90 246.91 279.81 239.18  445.20  330.24 163.86
吉林   1561.86 492.42 200.49 218.36 220.69  459.62  360.48 147.76
黑龙江 1410.11 510.71 211.88 277.11 224.65  376.82  317.61 152.85
上海   3712.31 550.74 893.37 346.93 527.00 1034.98  720.33 462.03
浙江   2629.16 557.32 689.73 435.69 514.66  795.87  575.76 323.36
安徽   1844.78 430.29 271.28 126.33 250.56  513.18  314.00 151.39
福建   2709.46 428.11 334.12 160.77 405.14  461.67  535.13 232.29
江西   1563.78 303.65 233.81 107.90 209.70  393.99  509.39 160.12
山东   1675.75 613.32 550.71 219.79 272.59  599.43  371.62 211.84
河南   1427.65 431.79 288.55 208.14 217.00  337.76  421.31 165.32
湖北   1783.43 511.88 282.84 201.01 237.60  617.74  523.52 182.52
湖南   1942.23 512.27 401.39 206.06 321.29  697.22  492.60 226.45
广东   3055.17 353.23 564.56 356.27 811.88  873.06 1082.82 420.81
广西   2033.87 300.82 338.65 157.78 329.06  621.74  587.02 218.27
海南   2057.86 186.44 202.72 171.79 329.65  477.17  312.93 279.19
重庆   2303.29 589.99 516.21 236.55 403.92  730.05  438.41 225.80
四川   1974.28 507.76 344.79 203.21 240.24  575.10  430.36 223.46
贵州   1673.82 437.75 461.61 153.32 254.66  445.59  346.11 191.48
云南   2194.25 537.01 369.07 249.54 290.84  561.91  407.70 330.95
西藏   2646.61 839.70 204.44 209.11 379.30  371.04  269.59 389.33
陕西   1472.95 390.89 447.95 259.51 230.61  490.90  469.10 191.34
甘肃   1525.57 472.98 328.90 219.86 206.65  449.69  249.66 228.19
青海   1654.69 437.77 258.78 303.00 244.93  479.53  288.56 236.51
宁夏   1375.46 480.99 273.84 317.32 251.08  424.75  228.73 195.93
新疆   1608.82 536.05 432.46 235.82 250.28  541.30  344.85 214.40
> model.hclust<-hclust(dist(city))
> plot(model.hclust)
> rect.hclust(model.hclust,5)

```

模型图：

![](https://github.com/user-wbgithub/R/blob/master/images/2020-02-07_171015.jpg)

指定分类模型图：

![](https://github.com/user-wbgithub/R/blob/master/images/2020-02-07_171053.jpg)

在样本量的情况下，层次越多，计算代价越大。生产情况下一般不适用系统聚类法(分层)，下面学习K-Means算法。

# K-Means聚类算法

K-Means是一种随机算法--意味着需要迭代才能够收敛。

### K-Means算法过程

①从N样本数据中随机选择K个对象作为初始聚类中心（这里是分为K类）

②分别计算每个样本到各个聚类中心的距离，将对象分配到距离最近的聚类中

​		如下图：

![](https://github.com/user-wbgithub/R/blob/master/images/2020-02-07_180323.jpg)

③分配完对象之后重新计算K个聚类的中心 （这里是求每个聚类的平均值）

​		如下图：

![](https://github.com/user-wbgithub/R/blob/master/images/2020-02-07_180717.jpg)

④计算和上一次聚类中心的距离，如果差异很大，说明算法没有收敛，则需要继续迭代。直至

质心相等或者小于指定阈值。算法收敛

​		质心不相等如下图：

![](https://github.com/user-wbgithub/R/blob/master/images/2020-02-07_182041.jpg)

### R中使用K-Means聚类算法建模

数据框数据集-->建立模型kmeans(数据集，分类的个数，迭代的次数)-->查看模型-->对模型进行排序（sort）

```R
> city
            x1     x2     x3     x4     x5      x6      x7     x8
北京   2959.19 730.79 749.41 513.34 467.87 1141.82  478.42 457.64
天津   2459.77 495.47 697.33 302.87 284.19  735.97  570.84 305.08
河北   1495.63 515.90 362.37 285.32 272.95  540.58  364.91 188.63
山西   1046.33 477.77 290.15 208.57 201.50  414.72  281.84 212.10
内蒙古 1303.97 524.29 254.83 192.17 249.81  463.09  287.87 192.96
辽宁   1730.84 553.90 246.91 279.81 239.18  445.20  330.24 163.86
吉林   1561.86 492.42 200.49 218.36 220.69  459.62  360.48 147.76
黑龙江 1410.11 510.71 211.88 277.11 224.65  376.82  317.61 152.85
上海   3712.31 550.74 893.37 346.93 527.00 1034.98  720.33 462.03
浙江   2629.16 557.32 689.73 435.69 514.66  795.87  575.76 323.36
安徽   1844.78 430.29 271.28 126.33 250.56  513.18  314.00 151.39
福建   2709.46 428.11 334.12 160.77 405.14  461.67  535.13 232.29
江西   1563.78 303.65 233.81 107.90 209.70  393.99  509.39 160.12
山东   1675.75 613.32 550.71 219.79 272.59  599.43  371.62 211.84
河南   1427.65 431.79 288.55 208.14 217.00  337.76  421.31 165.32
湖北   1783.43 511.88 282.84 201.01 237.60  617.74  523.52 182.52
湖南   1942.23 512.27 401.39 206.06 321.29  697.22  492.60 226.45
广东   3055.17 353.23 564.56 356.27 811.88  873.06 1082.82 420.81
广西   2033.87 300.82 338.65 157.78 329.06  621.74  587.02 218.27
海南   2057.86 186.44 202.72 171.79 329.65  477.17  312.93 279.19
重庆   2303.29 589.99 516.21 236.55 403.92  730.05  438.41 225.80
四川   1974.28 507.76 344.79 203.21 240.24  575.10  430.36 223.46
贵州   1673.82 437.75 461.61 153.32 254.66  445.59  346.11 191.48
云南   2194.25 537.01 369.07 249.54 290.84  561.91  407.70 330.95
西藏   2646.61 839.70 204.44 209.11 379.30  371.04  269.59 389.33
陕西   1472.95 390.89 447.95 259.51 230.61  490.90  469.10 191.34
甘肃   1525.57 472.98 328.90 219.86 206.65  449.69  249.66 228.19
青海   1654.69 437.77 258.78 303.00 244.93  479.53  288.56 236.51
宁夏   1375.46 480.99 273.84 317.32 251.08  424.75  228.73 195.93
新疆   1608.82 536.05 432.46 235.82 250.28  541.30  344.85 214.40
> model.km<-kmeans(city,5,nstart=20)
> model.km
K-means clustering with 5 clusters of sizes 7, 5, 2, 1, 15

Cluster means:
        x1       x2       x3      x4       x5        x6        x7       x8
1 1975.814 426.6386 315.8200 187.960 285.6057  580.5800  438.3043 230.3186
2 2549.658 582.1180 488.3660 268.998 397.4420  618.9200  477.9460 295.1720
3 3335.750 640.7650 821.3900 430.135 497.4350 1088.4000  599.3750 459.8350
4 3055.170 353.2300 564.5600 356.270 811.8800  873.0600 1082.8200 420.8100
5 1501.815 478.6787 322.8827 232.400 236.4187  457.5313  344.8187 190.2193

Clustering vector:
  北京   天津   河北   山西 内蒙古   辽宁   吉林 黑龙江   上海   浙江 
     3      2      5      5      5      5      5      5      3      2 
  安徽   福建   江西   山东   河南   湖北   湖南   广东   广西   海南 
     1      2      5      5      5      1      1      4      1      1 
  重庆   四川   贵州   云南   西藏   陕西   甘肃   青海   宁夏   新疆 
     2      1      5      1      2      5      5      5      5      5 

Within cluster sum of squares by cluster:
[1] 385650.4 698464.2 360737.7      0.0 873285.0
 (between_SS / total_SS =  84.6 %)

Available components:

[1] "cluster"      "centers"      "totss"        "withinss"    
[5] "tot.withinss" "betweenss"    "size"         "iter"        
[9] "ifault"      
> sort(model.km$cluster)
  安徽   湖北   湖南   广西   海南   四川   云南   天津   浙江   福建 
     1      1      1      1      1      1      1      2      2      2 
  重庆   西藏   北京   上海   广东   河北   山西 内蒙古   辽宁   吉林 
     2      2      3      3      4      5      5      5      5      5 
黑龙江   江西   山东   河南   贵州   陕西   甘肃   青海   宁夏   新疆 
     5      5      5      5      5      5      5      5      5      5 

```

